#
# THIS FILE IS MANAGED BY PUPPET
# <%= file %>
#

# Fail2Ban configuration file.
#
# The DEFAULT allows a global definition of the options. They can be override
# in each jail afterwards.

[DEFAULT]

# "ignoreip" can be an IP address, a CIDR mask or a DNS host
ignoreip = <%= scope.lookupvar('::fail2ban::whitelist').join(" ") %>
bantime  = <%= scope.lookupvar('::fail2ban::bantime') %>
maxretry = <%= scope.lookupvar('::fail2ban::maxretry') %>

#
# Destination email address used solely for the interpolations in
# jail.{conf,local} configuration files.
destemail = <%= scope.lookupvar('::fail2ban::email') %>

#
# ACTIONS
#

# Default banning action (e.g. iptables, iptables-new,
# iptables-multiport, shorewall, etc) It is used to define
# action_* variables. Can be overriden globally or per
# section within jail.local file
banaction = pf[actiontype=<allports>]

#
# JAILS
#

# Next jails corresponds to the standard configuration in Fail2ban 0.6 which
# was shipped in Debian. Enable any defined here jail by including
#
# [SECTION_NAME]
# enabled = true

#
# in /etc/fail2ban/jail.local.
#
# Optionally you may override any other parameter (e.g. banaction,
# action, port, logpath, etc) in that section within jail.local

[sshd]

enabled = <%= scope.lookupvar('::fail2ban::jails').include? "sshd" %>
mode = ddos
bantime = -1
# FIXME:
#mode.... = <%= scope.lookupvar('::fail2ban::jails').include? "ssh-ddos" %>

# Generic filter for pam. Has to be used with action which bans all ports
# such as iptables-allports, shorewall
[pam-generic]

enabled = <%= scope.lookupvar('::fail2ban::jails').include? "pam-generic" %>

[xinetd-fail]

enabled   = <%= scope.lookupvar('::fail2ban::jails').include? "xinetd-fail" %>

#
# Mail servers
#

[postfix]

enabled  = <%= scope.lookupvar('::fail2ban::jails').include? "postfix" %>


[postfix-sasl]

enabled  = <%= scope.lookupvar('::fail2ban::jails').include? "postfix-sasl" %>
bantime = -1


# dovecot defaults to logging to the mail syslog facility
# but can be set by syslog_facility in the dovecot configuration.
[dovecot]

enabled = <%= scope.lookupvar('::fail2ban::jails').include? "dovecot" %>
#logpath = /var/log/maillog
